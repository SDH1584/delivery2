<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="storeDetail">

	<select id="reservList" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select og.order_no orderNo,
			       og.people people,
			       og.order_date orderDate,
			       og.delivery_m_adr deliveryMAdr,
			       og.delivery_s_adr deliverySAdr,
			       de.fee/og.people as pFee,
			       biz.min_price minPrice,
			       cp.countpeople+1 as countPeople
			from order_group og, delivery de, business biz, (select order_no,
			                                                        count(p_order_no) as countPeople
			                                                 from personal_order
			                                                 group by order_no
			                                                 ) cp
			where biz.store_no = og.store_no
			and biz.store_no = og.store_no
			and cp.order_no = og.order_no
			and cp.countpeople+1 <> og.people
			and og.store_no = #{storeNo}
			order by order_date desc	
		]]>

	</select>

	<select id="attend" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select p_order_no pOrderNo
			from personal_order
			where order_no = #{orderNo}
			and no = #{no}
		]]>
	</select>

	<select id="host" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select order_no orderNo,
			       store_no storeNo,
			       no
			from order_group
			where order_no = #{orderNo}
			and no = #{no}
		]]>
	</select>

	<select id="attendee" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select po.p_order_no pOrderNo,
			 	   og.store_no storeNo,
			 	   po.no
			from personal_order po, order_group og
			where po.order_no = og.order_no
			and po.order_no = #{orderNo}
			and po.no = #{no}
		]]>
	</select>

</mapper>