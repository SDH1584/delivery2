<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="storeDetail">

	<select id="reservList" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select og.order_no orderNo,
			       og.people people,
			       og.order_date orderDate,
			       og.delivery_m_adr deliveryMAdr,
			       og.delivery_s_adr deliverySAdr,
			       de.fee/og.people as pFee,
			       biz.min_price minPrice,
			       cp.countPeople,
			       cp.finalPay
			from order_group og, delivery de, business biz, (select order_no,
			                                                        count(p_order_no) as countPeople,
			                                                        sum(final_pay) as finalPay
			                                                 from personal_order
			                                                 group by order_no
			                                                 ) cp
			where biz.store_no = og.store_no
			and biz.store_no = og.store_no
			and cp.order_no = og.order_no
			and cp.countpeople <> og.people
			and og.store_no = #{storeNo}
			order by order_date desc	
		]]>

	</select>

	<select id="attend" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select p_order_no pOrderNo
			from personal_order
			where order_no = #{orderNo}
			and no = #{no}
		]]>
	</select>

	<select id="attendVfy" parameterType="com.javaex.vo.OrderVo" resultType="com.javaex.vo.OrderVo">
		<![CDATA[
			select po.p_order_no pOrderNo,
			       po.order_no,
			       po.attendVfy attendVfy,
			       po.no,
			       og.store_no
			from personal_order po, order_group og
			where po.order_no = og.order_no
			and po.order_no = #{orderNo}
			and po.no = #{no}
		]]>
	</select>


</mapper>